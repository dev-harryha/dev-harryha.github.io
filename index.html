<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>

    <div>
        <section class="section-main" id="section-main" style="position: absolute; float: left; width: 50%;">
            <header>
                <h1>Amazon Connect - Custom Implementation of Customer Chat</h1>
            </header>
        </section>
    </div>
<!--
  Amazon Connect Chat Widget - FPL Configuration
  This widget snippet includes all FPL customizations
  Place this code before the closing </body> tag on your website
-->
<script type="text/javascript">
  // ============================================
  // CHAT SESSION PERSISTENCE (Cross-tab support)
  // ============================================
  (function() {
    const cookie = document.cookie.split('; ').find(c => c.startsWith('activeChat='));
    if (cookie) {
      const activeChatValue = cookie.split('=')[1];
      sessionStorage.setItem('persistedChatSession', activeChatValue);
    }
  })();

  // ============================================
  // WIDGET INITIALIZATION
  // ============================================
  (function(w, d, x, id){
    s=d.createElement('script');
    s.src='https://xddev4cc00do300000iqbyn.my.connect.aws/connectwidget/static/amazon-connect-chat-interface-client.js';
    s.async=1;
    s.id=id;
    d.getElementsByTagName('head')[0].appendChild(s);
    w[x] = w[x] || function() { (w[x].ac = w[x].ac || []).push(arguments) };
  })(window, document, 'amazon_connect', '334810b5-e34d-428e-8c3d-c9e6f6ab4eb4');

  // ============================================
  // JWT AUTHENTICATION
  // ============================================
  // NOTE: JWT authentication is DISABLED for this widget
  // The widget (5319bbda-4d17-4210-820a-239bf38b31e4) has security set to "No"
  // If you need to re-enable JWT, uncomment the code below and enable security in Amazon Connect
  /*
  amazon_connect('authenticate', function(callback) {
    fetch('/token')
      .then(response => response.json())
      .then(data => callback(data.data))
      .catch(err => {
        console.error('Failed to fetch JWT:', err);
        callback('');
      });
  });
  */

  // ============================================
  // SESSION PERSISTENCE CALLBACKS
  // ============================================
  amazon_connect('registerCallback', {
    'CONNECTION_ESTABLISHED': () => {
      document.cookie = "activeChat=" + sessionStorage.getItem("persistedChatSession") + "; SameSite=None; Secure";
    },
    'CHAT_ENDED': () => {
      document.cookie = "activeChat=; SameSite=None; Secure";
    }
  });

  // ============================================
  // WIDGET STYLING
  // ============================================
  amazon_connect('styles', {
    iconType: 'CHAT',
    openChat: { color: '#ffffff', backgroundColor: '#0073a8', borderRadius: '25px' },
    closeChat: { color: '#ffffff', backgroundColor: '#0073a8' }
  });

  // ============================================
  // WIDGET SNIPPET ID
  // ============================================
  amazon_connect('snippetId', 'QVFJREFIaFg3VVJ2dFRXb2IrUUdndUkvUzRJMnRnQ1NJL3Erc1JKT0lFQ3lCQlNlUEFIbTZWeEFpd0xkNURObHl4YzVOT05hQUFBQWJqQnNCZ2txaGtpRzl3MEJCd2FnWHpCZEFnRUFNRmdHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNaHZhQ3BCQmhmclQxd0hhekFnRVFnQ3QrdjkrU3lLbUdTa0RyODN1Nmgwd21rVXJobGl3SUlhbi9BQnZKUUlHbFpyYld2SWh1UWtacUliRzM6OnZJRCtnLzJiSTNsSjd6b2YwNVlOcFl0U1IrOVFoaUlDQjRPLzNvaCtkdGVkcHZ5NjZzMmFkd1Jickl6dWEzSk1kMW5LVkU3YU5QMUxxT3NpV2UyUmF3YXk0REFjbi9NL1c1WU9Rcnd6K0Uwc3Nob1NodkRqU08xb3NVR2xoRGJPYVpZRG8zUE5RTHRiQ0ZKb3hncjdxcVpqeGtNWThvST0=');

  // ============================================
  // SUPPORTED MESSAGE CONTENT TYPES
  // ============================================
  amazon_connect('supportedMessagingContentTypes', [
    'text/plain',
    'text/markdown',
    'application/vnd.amazonaws.connect.message.interactive',
    'application/vnd.amazonaws.connect.message.interactive.response'
  ]);

  // ============================================
  // CUSTOM STYLES
  // ============================================
    amazon_connect('customStyles', {
    global: {
      fontSize: '13px',
      frameWidth: '420px',
      frameHeight: '640px',
    },
    transcript: {
      customerMessageTextColor: '#ffffff'
    },
    logo: {
      logoMaxHeight: '90px',
      logoMaxWidth: '95%',
      logoBackgroundColor: '#000000',
    },
    footer: {
      buttonBackgroundColor: '#0073a8',
      buttonTextColor: '#ffffff',
      buttonBorderColor: '#0073a8'
    },
    fullscreenMode: true,
    // Make the chat window wider
    // chatWidget: {
    //   width: '800px',  // Default is 360px, increase to make wider
    //   height: '600px'  // Optional: adjust height too
    // }
  });

  // ============================================
  // CUSTOMIZATION OBJECT
  // ============================================
  amazon_connect('customizationObject', {
    header: {
      dropdown: false,
      dynamicHeader: false,
      hideTranscriptDownloadButton: true,
    },
    transcript: {
      hideDisplayNames: true,
      displayIcons: true,
      iconSources: {
        botMessage: "https://amazon-connect-5c1e40e94c61.s3.us-east-1.amazonaws.com/connect/jakesandbox/CustomChatItems/fpl_resized_icon.png",
        systemMessage: "https://amazon-connect-5c1e40e94c61.s3.us-east-1.amazonaws.com/connect/jakesandbox/CustomChatItems/fpl_resized_icon.png",
        agentMessage: "https://amazon-connect-5c1e40e94c61.s3.us-east-1.amazonaws.com/connect/jakesandbox/CustomChatItems/fpl_resized_icon.png"
      },
      eventNames: {
        customer: "You",
        agent: "FPL Agent",
        supervisor: "FPL Supervisor"
      },
      eventMessages: {
        participantJoined: "Chat started",
        participantLeft: "{name} left the chat",
        chatEnded: "Chat ended. Thank you for contacting FPL.",
      },
    },
    composer: {
      disableEmojiPicker: true,
      disableCustomerAttachments: true,
      alwaysHideToolbar: true,
    },
    footer: {
      disabled: false,
      skipCloseChatButton: true,
    },
    endChat: {
      enableConfirmationDialog: false,
    },
    attachment: {
      rejectedErrorMessage: "Custom Error Message: Files cannot exceed 15 MB."
    }
  });
  // ============================================
  // OS-BASED RESPONSIVE SIZING
  // ============================================
  function detectOSAndResize() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
    let width = '420px';
    let height = '640px';
    let maxHeight = '85vh';

    // iOS (iPhone, iPad, iPod)
    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
      width = '90vw';
      height = '80vh';
      maxHeight = '80vh';
    }
    // Android
    else if (/android/i.test(userAgent)) {
      width = '90vw';
      height = '75vh';
      maxHeight = '75vh';
    }
    // Windows - use viewport height to handle scaling
    else if (navigator.platform.indexOf('Win') > -1) {
      width = '420px';
      height = '640px';
      maxHeight = '85vh';
    }
    // Mac
    else if (navigator.platform.indexOf('Mac') > -1) {
      width = '420px';
      height = '640px';
      maxHeight = '85vh';
    }
    // Linux
    else if (navigator.platform.indexOf('Linux') > -1) {
      width = '420px';
      height = '640px';
      maxHeight = '85vh';
    }

    const style = document.createElement('style');
    style.innerHTML = `
      /* Target the actual Amazon Connect frame container */
      [class*="acFrameContainer"].show {
        width: ${width} !important;
        height: ${height} !important;
        max-width: ${width} !important;
        max-height: ${maxHeight} !important;
      }

      /* Ensure iframe inside fills the container */
      [class*="acFrameContainer"].show iframe {
        width: 100% !important;
        height: 100% !important;
      }
    `;
    document.head.appendChild(style);
  }

  // Watch for the widget to appear
  const observer = new MutationObserver((mutations) => {
    const widgetContainer = document.querySelector('[class*="acFrameContainer"].show');
    if (widgetContainer) {
      detectOSAndResize();
      observer.disconnect(); // Stop watching once found
    }
  });

  observer.observe(document.body, {
    childList: true,
    subtree: true,
    attributes: true,
    attributeFilter: ['class']
  });
</script>

<!-- Auto-scroll fix for streaming messages -->
<!-- <script src="/chat-scroll-fix.js"></script> -->

<!-- Timestamp position/hide fix -->
<!-- <script src="/chat-timestamp-fix.js"></script> -->

</body>
